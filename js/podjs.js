$(function(){$('.unmute').on('click',function(){document.getElementById('soundtrack').muted=!document.getElementById('soundtrack').muted;$(this).toggleClass('mute');});if($('#soundtrack').length){$('#soundtrack').prop('volume',0.1);document.getElementById('soundtrack').muted=!document.getElementById('soundtrack').muted;$('.unmute').toggleClass('mute');}
$('.tooltip').hover(function(){$(this).find('span.tip').fadeIn("0");},function(){$(this).find('span.tip').fadeOut("0");});$('#icon').hover(function(){$('#serverinfo').css('display','block');},function(){$('#serverinfo').css('display','none');});$('.portalh').hover(function(){$(this).prev().css('display','inline-block');},function(){$(this).prev().css('display','none');});$('#armory-search').on('click',function(){if($(this).val()=='Character Name...'){$(this).val('');$(this).css('color','#9a9377');}})
$('#armory-search').bind("enterKey",function(e){window.location.href=window.location.protocol+'//'+window.location.host+window.location.pathname+'?name='+$(this).val();});$('#armory-search').keyup(function(e){if(e.keyCode==13){$(this).trigger("enterKey");}});$('#border').on('click',function(){window.location.href=window.location.protocol+'//'+window.location.host+'/p/';})
$('.logo').on('click',function(){window.location.href=window.location.protocol+'//'+window.location.host+'/p/';})
$('#armory-search-button').on('click',function(){$('#armory-search').trigger("enterKey");})
function pad(str,max,padLeft){str=str.toString();return str.length<max?pad("0"+str,max):str;}
function rpad(s,c,n){if(!s||!c||s.length>=n){return s;}
var max=(n-s.length)/c.length;for(var i=0;i<max;i++){s+=c;}
return s;}
function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return '';return decodeURIComponent(results[2].replace(/\+/g," "));}
function processSkillString(){if(getParameterByName('s')==null)return;var qstr=getParameterByName('s');qstr=rpad(qstr,'0',66);var skills=qstr.split(/(?=(?:..)*$)/);var entry=2;var total=110;var tier=0;$('.skillpoint').each(function(){var cur=$(this).attr('class').split(/\s+/)[1];if(parseInt(skills[entry],16)>0){$('.skillpoint.'+cur+' > img').css('opacity',0);total=total-parseInt(skills[entry],16);if(parseInt(skills[entry],16)>20){var version=$('#d2version').data('version');window.location.href=window.location.protocol+'//'+window.location.host+window.location.pathname+'?s='+version;}
if(parseInt(skills[entry],16)==20)
$('.skillcount.'+cur).addClass('max');}
if(parseInt(skills[entry],16).toString().substr(0,1)==0){$('.skillcount.'+cur).html(parseInt(skills[entry],16).toString().substr(1,1));}else{$('.skillcount.'+cur).html(parseInt(skills[entry],16));}
if($('.skillcount.'+cur).html()=="")
$('.skillcount.'+cur).html("0");if(cur.substr(-1)>tier)
tier=cur.substr(-1);entry++;});switch(parseInt(tier)){case 0:$('#level > span').html("0");break;case 1:$('#level > span').html("1");break;case 2:$('#level > span').html("6");break;case 3:$('#level > span').html("12");break;case 4:$('#level > span').html("18");break;case 5:$('#level > span').html("24");break;case 6:$('#level > span').html("30");break;}
$('#total').html(total);$('#url').val(window.location.href);}
function setSkillString(){var cls=getParameterByName('s').substr(2,2);var version=$('#d2version').data('version');var skillstr=version+cls+"";$('.skillcount').each(function(){skillstr+=pad(parseInt($(this).html()).toString(16),2);});if(history.pushState){var newurl=window.location.protocol+'//'+window.location.host+window.location.pathname+'?s='+skillstr;window.history.pushState({path:newurl},'',newurl);}
$("#url").val(newurl);}
$('#d2version').on('click',function(){if($('#d2version-menu').css('display')=="none"){$('#d2version > i.arrow').removeClass('down');$('#d2version > i.arrow').addClass('up');$('#d2version > i.arrow').css('top','2px');$('#d2version-menu').css('display','inline-block');}else{$('#d2version > i.arrow').addClass('down');$('#d2version > i.arrow').removeClass('up');$('#d2version > i.arrow').css('top','-2px');$('#d2version-menu').css('display','none');}});$('#d2version-menu > .d2version-choice').on('click',function(){var ss="";var s=getParameterByName('s');if(s.length>3){ss+=s.substr(2,2);}
var current=$('#d2version').data('version');var choice=$(this).data('version');if(current==choice)return;var newurl=window.location.protocol+'//'+window.location.host+window.location.pathname+'?s='+choice+ss;window.location.href=newurl;});$('#skill-calculator img.amazon').hover(function(){$("#skill-calculator > #class-image > .selected").html("Amazon");$("#skill-calculator > #class-image > .description").html("Skilled with the spear and the bow,<br/>she is a very versatile fighter.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.assassin').hover(function(){$("#skill-calculator > #class-image > .selected").html("Assassin");$("#skill-calculator > #class-image > .description").html("Schooled in the Martial Arts, her<br/>mind and body are deadly weapons.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.necromancer').hover(function(){$("#skill-calculator > #class-image > .selected").html("Necromancer");$("#skill-calculator > #class-image > .description").html("Summoning undead minions and cursing<br/>his enemies are his specialties.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.barbarian').hover(function(){$("#skill-calculator > #class-image > .selected").html("Barbarian");$("#skill-calculator > #class-image > .description").html("He is unequaled in close-quarters<br/>combat and mastery of weapons.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.paladin').hover(function(){$("#skill-calculator > #class-image > .selected").html("Paladin");$("#skill-calculator > #class-image > .description").html("He is a natural party leader, holy<br/>man, and blessed warrior.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.sorceress').hover(function(){$("#skill-calculator > #class-image > .selected").html("Sorceress");$("#skill-calculator > #class-image > .description").html("She has mastered the elemental<br/>magicks -- fire, lightning and ice.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$('#skill-calculator img.druid').hover(function(){$("#skill-calculator > #class-image > .selected").html("Druid");$("#skill-calculator > #class-image > .description").html("Commanding the forces of nature, he<br/>summons wild beasts and raging<br/>storms to his side.");},function(){$("#skill-calculator > #class-image > .selected").html("");$("#skill-calculator > #class-image > .description").html("");});$("input#url").on("click",function(){$(this).select();});$('.skillpoint > img').on('click',function(){var total=parseInt($('#total').html());var sp=$(this).parent().attr('class').split(/\s+/)[1];var count=parseInt($('.skillcount.'+sp).html());if(typeof $('.skillcount.'+sp).data('req')!='undefined'){console.log('moo');var prereqs=$('.skillcount.'+sp).data('req').split(' ');for(var i=0;i<prereqs.length;i++){var tmp=parseInt($('.skillcount.'+prereqs[i]).html());if(tmp==0)return;}}
if((count+1)>20)return;if(total-1<0)return;var row=parseInt(sp.substr(4));var level=parseInt($('#level > span').html());switch(row){case 1:if(level<1)$('#level > span').html("1");break;case 2:if(level<6)$('#level > span').html("6");break;case 3:if(level<12)$('#level > span').html("12");break;case 4:if(level<18)$('#level > span').html("18");break;case 5:if(level<24)$('#level > span').html("24");break;case 6:if(level<30)$('#level > span').html("30");break;}
if(count=="0"){$(this).css('opacity',0);}
if((count+1)==20){$('.skillcount.'+sp).addClass('max');}
$('.skillcount.'+sp).html(count+1);$('#total').html(total-1);setSkillString();});function scanPreReqs(sp){$('.skillcount[data-req~="'+sp+'"]').each(function(){var t=$(this).attr('class').split(/\s+/)[1];var total=parseInt($('#total').html());console.log('total: '+total);var addToTotal=parseInt($(this).html());console.log('add: '+addToTotal);$(this).html('0');$(this).removeClass('max');$('.skillpoint.'+t+' > img').css('opacity',0.65);$('#total').html(total+addToTotal);console.log('new total:'+(total+addToTotal));scanPreReqs($(this).attr('class').split(/\s+/)[1]);});}
$('.skillpoint > img').on('contextmenu',function(){var total=parseInt($('#total').html());var sp=$(this).parent().attr('class').split(/\s+/)[1];var count=parseInt($('.skillcount.'+sp).html());if((count-1)<0)return false;if(total+1>110)return false;var row=parseInt(sp.substr(4));var level=parseInt($('#level > span').html());if((count-1)=="0"){$(this).css('opacity',0.65);}
if(count==20){$('.skillcount.'+sp).removeClass('max');}
$('.skillcount.'+sp).html(count-1);$('#total').html(total+1);if((count-1)<=0){scanPreReqs(sp);}
var found1,found2,found3,found4,found5,found6;found1=found2=found3=found4=found5=found6=0;switch(row){default:for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r1').html())>0)found1++;if(parseInt($('.skillcount.bc'+i+'r1').html())>0)found1++;if(parseInt($('.skillcount.cc'+i+'r1').html())>0)found1++;}
for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r2').html())>0)found2++;if(parseInt($('.skillcount.bc'+i+'r2').html())>0)found2++;if(parseInt($('.skillcount.cc'+i+'r2').html())>0)found2++;}
for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r3').html())>0)found3++;if(parseInt($('.skillcount.bc'+i+'r3').html())>0)found3++;if(parseInt($('.skillcount.cc'+i+'r3').html())>0)found3++;}
for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r4').html())>0)found4++;if(parseInt($('.skillcount.bc'+i+'r4').html())>0)found4++;if(parseInt($('.skillcount.cc'+i+'r4').html())>0)found4++;}
for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r5').html())>0)found5++;if(parseInt($('.skillcount.bc'+i+'r5').html())>0)found5++;if(parseInt($('.skillcount.cc'+i+'r5').html())>0)found5++;}
for(var i=1;i<4;i++){if(parseInt($('.skillcount.ac'+i+'r6').html())>0)found6++;if(parseInt($('.skillcount.bc'+i+'r6').html())>0)found6++;if(parseInt($('.skillcount.cc'+i+'r6').html())>0)found6++;}
if(found1<1&&found2<1&&found3<1&&found4<1&&found5<1&&found6<1)$('#level > span').html("0");else if(found1<2&&(found2<1&&found3<1&&found4<1&&found5<1&&found6<1))$('#level > span').html("1");else if(found2<2&&(found3<1&&found4<1&&found5<1&&found6<1))$('#level > span').html("6");else if(found3<2&&(found4<1&&found5<1&&found6<1))$('#level > span').html("12");else if(found4<2&&(found5<1&&found6<1))$('#level > span').html("18");else if(found5<2&&(found6<1))$('#level > span').html("24");else $('#level > span').html("30");}
setSkillString();return false;});processSkillString();});